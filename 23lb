Я предоставлю вам полный код для выполнения задания 3.1 в приложении WPF, включая необходимую XAML-разметку и логику на C#. Мы будем использовать комбобокс для выбора игры и кнопку для выполнения операции.
1. Подготовка классов C# (Модель и Контекст)
Прежде чем приступать к WPF-коду, убедитесь, что у вас есть классы сущностей и контекста EF Core.
Класс сущности LW23Game
Убедитесь, что ваше свойство для имени (которое маппируется на столбец name в БД) и поле logoFile имеют правильный регистр и типы:
// Файл: Models/LW23Game.cs
public class LW23Game
{
    // IdGame - соответствует первичному ключу
    public int IdGame { get; set; } 
    
    // Name - соответствует столбцу name
    public string Name { get; set; } 
    
    // logoFile - соответствует столбцу logoFile (nvarchar(120))
    public string? logoFile { get; set; } 
    
    // ... другие свойства (Description, Price, IdCategory и т.д.)
}

Класс контекста YourDbContext
Убедитесь, что ваш контекст правильно настроен:
// Файл: Data/YourDbContext.cs
public class YourDbContext : DbContext
{
    public DbSet<LW23Game> LW23Games { get; set; }
    
    // ... (Настройка OnConfiguring или конструктора) ...
}

2. XAML-разметка (MainWindow.xaml)
Эта разметка содержит ComboBox для выбора игры, TextBox для отображения пути к файлу и две кнопки: "Обзор..." (для выбора файла) и "Сохранить" (для выполнения задания 3.1.3).
<Window x:Class="LabWork23.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Лабораторная №23. Задание 3.1" Height="250" Width="550">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Label Content="1. Выберите Игру:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
        <ComboBox Name="GameComboBox" 
                  Grid.Row="0" Grid.Column="1" 
                  DisplayMemberPath="Name"       
                  SelectedValuePath="IdGame" 
                  Margin="5"
                  DropDownOpened="GameComboBox_DropDownOpened" /> 
        
        <Label Content="2. Файл логотипа:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
        <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="5">
            <TextBox Name="LogoPathTextBox" Width="300" IsReadOnly="True" Margin="0,0,10,0" 
                     VerticalAlignment="Center" Text="Нажмите 'Обзор...'"/>
            <Button Content="Обзор..." Click="BrowseButton_Click" Padding="10,0"/>
        </StackPanel>

        <Button Content="3. Сохранить" 
                Grid.Row="3" Grid.ColumnSpan="2" 
                HorizontalAlignment="Left" 
                Click="SaveButton_Click" 
                Margin="0,20,0,0" 
                Padding="20,8"/>
    </Grid>
</Window>

3. C#-логика (MainWindow.xaml.cs)
Здесь реализуется вся логика задания 3.1.2 и 3.1.3: отложенная загрузка списка, выбор файла и основная логика сохранения (копирование файла + обновление БД).
using System;
using System.IO;
using System.Linq;
using System.Windows;
using Microsoft.Win32;
// Добавьте свои using для EF Core и моделей
using Microsoft.EntityFrameworkCore; 
// using YourProject.Data; 
// using YourProject.Models; 

namespace LabWork23 
{
    // Используйте ваш реальный DbContext
    public partial class MainWindow : Window
    {
        private readonly YourDbContext _context = new YourDbContext(); 
        // Флаг для отложенной загрузки данных
        private bool _isGameListLoaded = false; 

        public MainWindow()
        {
            InitializeComponent();
        }

        // Отложенная загрузка списка игр при первом открытии ComboBox
        private void GameComboBox_DropDownOpened(object sender, EventArgs e)
        {
            if (!_isGameListLoaded)
            {
                try
                {
                    // Загрузка всех игр из БД
                    GameComboBox.ItemsSource = _context.LW23Games.ToList();
                    _isGameListLoaded = true; 
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"Ошибка загрузки данных из БД: {ex.Message}", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
        }

        // Обработчик кнопки "Обзор..." (для выбора файла)
        private void BrowseButton_Click(object sender, RoutedEventArgs e)
        {
            OpenFileDialog openFileDialog = new OpenFileDialog
            {
                Filter = "Файлы изображений|*.jpg;*.jpeg;*.png;*.gif",
                Title = "Выберите файл логотипа для игры"
            };

            if (openFileDialog.ShowDialog() == true) 
            {
                LogoPathTextBox.Text = openFileDialog.FileName;
            }
        }

        // Обработчик кнопки "Сохранить" (Главная логика задания 3.1.3)
        private void SaveButton_Click(object sender, RoutedEventArgs e)
        {
            // 1. Проверка ввода
            if (GameComboBox.SelectedValue == null)
            {
                MessageBox.Show("Пожалуйста, выберите игру.", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                return;
            }
            string sourceFilePath = LogoPathTextBox.Text;
            if (string.IsNullOrWhiteSpace(sourceFilePath) || !File.Exists(sourceFilePath))
            {
                MessageBox.Show("Пожалуйста, выберите существующий файл логотипа.", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                return;
            }

            int selectedGameId = (int)GameComboBox.SelectedValue;
            string fileName = Path.GetFileName(sourceFilePath);

            // 2. Эмуляция загрузки: определение и создание целевой папки
            string targetDirectory = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "GamesLogo");
            string targetFilePath = Path.Combine(targetDirectory, fileName);

            try
            {
                // Создание папки "GamesLogo", если она не существует
                if (!Directory.Exists(targetDirectory))
                {
                    Directory.CreateDirectory(targetDirectory);
                }

                // Копирование файла (эмуляция загрузки на сервер)
                File.Copy(sourceFilePath, targetFilePath, overwrite: true);

                // 3. Обновление записи в БД
                var gameToUpdate = _context.LW23Games.Find(selectedGameId);

                if (gameToUpdate != null)
                {
                    // Запись имени файла в поле logoFile
                    gameToUpdate.logoFile = fileName; 
                    _context.SaveChanges();
                    
                    MessageBox.Show($"Логотип '{fileName}' успешно загружен в папку и привязан к игре.", 
                                    "Успех", 
                                    MessageBoxButton.OK, 
                                    MessageBoxImage.Information);
                }
            }
            catch (Exception ex)
            {
                // Если возникла ошибка, например, проблемы с правами доступа к папке или БД
                MessageBox.Show($"Произошла ошибка при сохранении: {ex.Message}", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}

// 1. Модель данных (Entity Framework Core)
public class LW23Game
{
    public int IdGame { get; set; }
    // ... другие поля
    public string? logoFile { get; set; } // Добавленное поле
}

// 2. Логика обработки сохранения (например, в обработчике кнопки "Сохранить")
public void SaveLogo(int gameId, string sourceFilePath)
{
    // A. Копирование файла в целевую папку
    string targetDirectory = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "GamesLogo");
    if (!Directory.Exists(targetDirectory))
    {
        Directory.CreateDirectory(targetDirectory);
    }

    string fileName = Path.GetFileName(sourceFilePath);
    string targetFilePath = Path.Combine(targetDirectory, fileName);

    try
    {
        // Выполняем копирование
        File.Copy(sourceFilePath, targetFilePath, overwrite: true);

        // B. Запись имени файла в БД с помощью EF Core
        using (var context = new YourDbContext()) // Замените на имя вашего DbContext
        {
            var game = context.LW23Games.FirstOrDefault(g => g.IdGame == gameId);
            if (game != null)
            {
                game.logoFile = fileName; // Записываем только имя файла
                context.SaveChanges();
            }
        }
        MessageBox.Show($"Логотип успешно сохранен и привязан к игре {fileName}");
    }
    catch (Exception ex)
    {
        MessageBox.Show($"Ошибка при сохранении: {ex.Message}");
    }
}








Конечно! Вот пошаговая реализация пользовательского интерфейса (UI) и логики для задания 3.1 в приложении WPF с использованием Entity Framework Core.
Для работы кода вам нужно, чтобы ваш проект имел:
 * Установленные пакеты Microsoft.EntityFrameworkCore.Tools и соответствующий провайдер (например, .SqlServer).
 * Определенный класс сущности LW23Game с полем logoFile.
 * Определенный класс контекста базы данных (YourDbContext).
1. XAML-разметка (MainWindow.xaml)
Эта разметка создает простой интерфейс с выпадающим списком для выбора игры, полем для пути к файлу и кнопками "Обзор..." и "Сохранить".
<Window x:Class="LabWork23.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Задание 3.1: Импорт логотипов" Height="250" Width="500"
        Loaded="Window_Loaded">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Label Content="Выберите игру:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
        <ComboBox Name="GameComboBox" 
                  Grid.Row="0" Grid.Column="1" 
                  DisplayMemberPath="name"       
                  SelectedValuePath="IdGame" 
                  Margin="5" />

        <Label Content="Путь к файлу логотипа:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
        <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="5">
            <TextBox Name="LogoPathTextBox" Width="250" IsReadOnly="True" Margin="0,0,10,0"/>
            <Button Content="Обзор..." Click="BrowseButton_Click" Padding="10,0"/>
        </StackPanel>

        <Button Content="Сохранить" 
                Grid.Row="3" Grid.ColumnSpan="2" 
                HorizontalAlignment="Left" 
                Click="SaveButton_Click" 
                Margin="0,20,0,0" 
                Padding="20,8"/>
    </Grid>
</Window>

2. C#-логика (MainWindow.xaml.cs)
Вам потребуется добавить using для работы с файлами и EF Core, а также использовать стандартный для WPF класс OpenFileDialog из пространства имен Microsoft.Win32.
using System;
using System.IO;
using System.Linq;
using System.Windows;
using Microsoft.Win32;
// using YourProject.Data; // Убедитесь, что здесь указан нужный namespace для DbContext
// using YourProject.Models; // Убедитесь, что здесь указан нужный namespace для LW23Game

namespace LabWork23 
{
    // Замените эти классы на ваши реальные классы DbContext и сущности LW23Game
    // Примерная структура класса LW23Game:
    /*
    public class LW23Game
    {
        public int IdGame { get; set; }
        public string name { get; set; }
        // ... другие поля
        public string? logoFile { get; set; } 
    }
    */
    
    public partial class MainWindow : Window
    {
        // Создайте экземпляр вашего DbContext
        private readonly YourDbContext _context = new YourDbContext(); 

        public MainWindow()
        {
            InitializeComponent();
        }

        // Загрузка данных при старте окна
        private void Window_Loaded(object sender, RoutedEventArgs e)
        {
            LoadGames();
        }

        private void LoadGames()
        {
            try
            {
                // Загрузка всех игр и привязка к ComboBox
                var games = _context.LW23Games.ToList();
                GameComboBox.ItemsSource = games;
                // DisplayMemberPath и SelectedValuePath установлены в XAML
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Ошибка загрузки игр: {ex.Message}", "Ошибка БД", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        // Обработчик кнопки "Обзор..."
        private void BrowseButton_Click(object sender, RoutedEventArgs e)
        {
            OpenFileDialog openFileDialog = new OpenFileDialog
            {
                Filter = "Файлы изображений|*.jpg;*.jpeg;*.png;*.gif",
                Title = "Выберите файл логотипа для игры"
            };

            // ShowDialog() в WPF возвращает bool?
            if (openFileDialog.ShowDialog() == true) 
            {
                LogoPathTextBox.Text = openFileDialog.FileName;
            }
        }

        // Обработчик кнопки "Сохранить" (Основная логика 3.1.3)
        private void SaveButton_Click(object sender, RoutedEventArgs e)
        {
            // 1. Проверка ввода
            if (GameComboBox.SelectedValue == null)
            {
                MessageBox.Show("Пожалуйста, выберите игру.", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                return;
            }
            string sourceFilePath = LogoPathTextBox.Text;
            if (string.IsNullOrWhiteSpace(sourceFilePath) || !File.Exists(sourceFilePath))
            {
                MessageBox.Show("Пожалуйста, выберите существующий файл логотипа.", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                return;
            }

            int selectedGameId = (int)GameComboBox.SelectedValue;
            string fileName = Path.GetFileName(sourceFilePath);

            // 2. Эмуляция загрузки: определение и создание целевой папки
            // BaseDirectory указывает на папку, где находится исполняемый файл приложения
            string targetDirectory = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "GamesLogo");
            string targetFilePath = Path.Combine(targetDirectory, fileName);

            try
            {
                // Создание папки, если она не существует
                if (!Directory.Exists(targetDirectory))
                {
                    Directory.CreateDirectory(targetDirectory);
                }

                // Копирование файла (эмуляция загрузки на сервер/хранилище)
                File.Copy(sourceFilePath, targetFilePath, overwrite: true);

                // 3. Обновление записи в БД
                var gameToUpdate = _context.LW23Games.Find(selectedGameId);

                if (gameToUpdate != null)
                {
                    // Запись имени файла в поле logoFile
                    gameToUpdate.logoFile = fileName; 
                    _context.SaveChanges();
                    
                    MessageBox.Show($"Логотип '{fileName}' успешно загружен и привязан к игре.", "Успех", MessageBoxButton.OK, MessageBoxImage.Information);
                }
            }
            catch (Exception ex)
            {
                // Обработка ошибок копирования или сохранения в БД
                MessageBox.Show($"Произошла ошибка при сохранении: {ex.Message}", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}










Я понял. Вы хотите, чтобы я представил решение для WPF, где есть выпадающий список для выбора сущности (фильма/игры) и отдельная кнопка для выбора файла.
Поскольку Лабораторная работа №23 явно касается Игр (LW23Games), я буду использовать модель Игры, но структура интерфейса будет именно такой, как вы описали (ComboBox для выбора объекта + Кнопка для выбора файла).
Вот обновленная и проверенная реализация для WPF.
1. XAML-разметка (MainWindow.xaml)
В этой разметке ComboBox используется для выбора Игры (аналог вашего "фильма"), а Button с текстом "Обзор..." — для выбора файла логотипа.
<Window x:Class="LabWork23.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Задание 3.1: Привязка логотипа" Height="250" Width="500"
        Loaded="Window_Loaded">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Label Content="Выберите Игру:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
        <ComboBox Name="GameComboBox" 
                  Grid.Row="0" Grid.Column="1" 
                  DisplayMemberPath="name"       
                  SelectedValuePath="IdGame" 
                  Margin="5" />

        <Label Content="Файл логотипа:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
        <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="5">
            <TextBox Name="LogoPathTextBox" Width="250" IsReadOnly="True" Margin="0,0,10,0" 
                     VerticalAlignment="Center" Text="Путь к файлу..."/>
            <Button Content="Обзор..." Click="BrowseButton_Click" Padding="10,0"/>
        </StackPanel>

        <Button Content="Сохранить" 
                Grid.Row="3" Grid.ColumnSpan="2" 
                HorizontalAlignment="Left" 
                Click="SaveButton_Click" 
                Margin="0,20,0,0" 
                Padding="20,8"/>
    </Grid>
</Window>

2. C#-логика (MainWindow.xaml.cs)
Код-за кулисами реализует привязку данных к ComboBox и обработку нажатия кнопок.
Ключевые моменты:
 * Window_Loaded: Заполняет GameComboBox данными из БД.
 * BrowseButton_Click: Использует OpenFileDialog для выбора файла и записывает путь в LogoPathTextBox.
 * SaveButton_Click: Выполняет копирование файла в папку GamesLogo и обновляет БД.
<!-- end list -->
using System;
using System.IO;
using System.Linq;
using System.Windows;
using Microsoft.Win32;
// Вам нужно определить свои пространства имен:
// using YourProject.Data; // Пространство имен для YourDbContext
// using YourProject.Models; // Пространство имен для LW23Game

namespace LabWork23 
{
    // Замените YourDbContext и LW23Game на ваши реальные классы
    public class LW23Game
    {
        public int IdGame { get; set; }
        public string name { get; set; }
        public string? logoFile { get; set; } 
    }
    
    // ПРЕДУПРЕЖДЕНИЕ: В реальном проекте замените на ваш DbContext!
    // Этот класс-заглушка нужен только для компиляции примера.
    public class YourDbContext : IDisposable 
    {
        public System.Collections.Generic.List<LW23Game> LW23Games { get; set; } = new System.Collections.Generic.List<LW23Game>
        {
            new LW23Game { IdGame = 1, name = "Doom Eternal" },
            new LW23Game { IdGame = 2, name = "The Witcher 3" },
            new LW23Game { IdGame = 3, name = "Cyberpunk 2077" }
        };

        public LW23Game Find(int id) => LW23Games.FirstOrDefault(g => g.IdGame == id);
        public System.Collections.Generic.List<LW23Game> ToList() => LW23Games;
        public int SaveChanges() { /* Логика сохранения в БД */ return 1; }
        public void Dispose() { /* Логика освобождения ресурсов */ }
    }


    public partial class MainWindow : Window
    {
        private readonly YourDbContext _context = new YourDbContext(); 

        public MainWindow()
        {
            InitializeComponent();
        }

        private void Window_Loaded(object sender, RoutedEventArgs e)
        {
            LoadGames();
        }

        private void LoadGames()
        {
            try
            {
                // Загрузка всех игр и привязка к ComboBox
                GameComboBox.ItemsSource = _context.LW23Games.ToList();
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Ошибка загрузки игр: {ex.Message}", "Ошибка БД", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        // Обработчик кнопки "Обзор..." (Выбор файла)
        private void BrowseButton_Click(object sender, RoutedEventArgs e)
        {
            OpenFileDialog openFileDialog = new OpenFileDialog
            {
                Filter = "Файлы изображений|*.jpg;*.jpeg;*.png;*.gif",
                Title = "Выберите файл логотипа для игры"
            };

            if (openFileDialog.ShowDialog() == true) 
            {
                LogoPathTextBox.Text = openFileDialog.FileName;
            }
        }

        // Обработчик кнопки "Сохранить" (Логика копирования и обновления БД)
        private void SaveButton_Click(object sender, RoutedEventArgs e)
        {
            // 1. Проверка выбора и пути
            if (GameComboBox.SelectedValue == null)
            {
                MessageBox.Show("Пожалуйста, выберите игру.", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                return;
            }
            string sourceFilePath = LogoPathTextBox.Text;
            if (string.IsNullOrWhiteSpace(sourceFilePath) || !File.Exists(sourceFilePath))
            {
                MessageBox.Show("Пожалуйста, выберите существующий файл логотипа.", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                return;
            }

            int selectedGameId = (int)GameComboBox.SelectedValue;
            string fileName = Path.GetFileName(sourceFilePath);

            // 2. Эмуляция загрузки: определение и создание целевой папки
            string targetDirectory = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "GamesLogo");
            string targetFilePath = Path.Combine(targetDirectory, fileName);

            try
            {
                if (!Directory.Exists(targetDirectory))
                {
                    Directory.CreateDirectory(targetDirectory);
                }

                // Копирование файла
                File.Copy(sourceFilePath, targetFilePath, overwrite: true);

                // 3. Обновление записи в БД
                var gameToUpdate = _context.LW23Games.Find(selectedGameId);

                if (gameToUpdate != null)
                {
                    gameToUpdate.logoFile = fileName; 
                    _context.SaveChanges();
                    
                    MessageBox.Show($"Логотип '{fileName}' успешно загружен и привязан к игре.", "Успех", MessageBoxButton.OK, MessageBoxImage.Information);
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Произошла ошибка при сохранении: {ex.Message}", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}













Я предоставлю вам полный код для выполнения задания 3.1 в приложении WPF, включая необходимую XAML-разметку и логику на C#. Мы будем использовать комбобокс для выбора игры и кнопку для выполнения операции.
1. Подготовка классов C# (Модель и Контекст)
Прежде чем приступать к WPF-коду, убедитесь, что у вас есть классы сущностей и контекста EF Core.
Класс сущности LW23Game
Убедитесь, что ваше свойство для имени (которое маппируется на столбец name в БД) и поле logoFile имеют правильный регистр и типы:
// Файл: Models/LW23Game.cs
public class LW23Game
{
    // IdGame - соответствует первичному ключу
    public int IdGame { get; set; } 
    
    // Name - соответствует столбцу name
    public string Name { get; set; } 
    
    // logoFile - соответствует столбцу logoFile (nvarchar(120))
    public string? logoFile { get; set; } 
    
    // ... другие свойства (Description, Price, IdCategory и т.д.)
}

Класс контекста YourDbContext
Убедитесь, что ваш контекст правильно настроен:
// Файл: Data/YourDbContext.cs
public class YourDbContext : DbContext
{
    public DbSet<LW23Game> LW23Games { get; set; }
    
    // ... (Настройка OnConfiguring или конструктора) ...
}

2. XAML-разметка (MainWindow.xaml)
Эта разметка содержит ComboBox для выбора игры, TextBox для отображения пути к файлу и две кнопки: "Обзор..." (для выбора файла) и "Сохранить" (для выполнения задания 3.1.3).
<Window x:Class="LabWork23.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Лабораторная №23. Задание 3.1" Height="250" Width="550">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Label Content="1. Выберите Игру:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
        <ComboBox Name="GameComboBox" 
                  Grid.Row="0" Grid.Column="1" 
                  DisplayMemberPath="Name"       
                  SelectedValuePath="IdGame" 
                  Margin="5"
                  DropDownOpened="GameComboBox_DropDownOpened" /> 
        
        <Label Content="2. Файл логотипа:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
        <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="5">
            <TextBox Name="LogoPathTextBox" Width="300" IsReadOnly="True" Margin="0,0,10,0" 
                     VerticalAlignment="Center" Text="Нажмите 'Обзор...'"/>
            <Button Content="Обзор..." Click="BrowseButton_Click" Padding="10,0"/>
        </StackPanel>

        <Button Content="3. Сохранить" 
                Grid.Row="3" Grid.ColumnSpan="2" 
                HorizontalAlignment="Left" 
                Click="SaveButton_Click" 
                Margin="0,20,0,0" 
                Padding="20,8"/>
    </Grid>
</Window>

3. C#-логика (MainWindow.xaml.cs)
Здесь реализуется вся логика задания 3.1.2 и 3.1.3: отложенная загрузка списка, выбор файла и основная логика сохранения (копирование файла + обновление БД).
using System;
using System.IO;
using System.Linq;
using System.Windows;
using Microsoft.Win32;
// Добавьте свои using для EF Core и моделей
using Microsoft.EntityFrameworkCore; 
// using YourProject.Data; 
// using YourProject.Models; 

namespace LabWork23 
{
    // Используйте ваш реальный DbContext
    public partial class MainWindow : Window
    {
        private readonly YourDbContext _context = new YourDbContext(); 
        // Флаг для отложенной загрузки данных
        private bool _isGameListLoaded = false; 

        public MainWindow()
        {
            InitializeComponent();
        }

        // Отложенная загрузка списка игр при первом открытии ComboBox
        private void GameComboBox_DropDownOpened(object sender, EventArgs e)
        {
            if (!_isGameListLoaded)
            {
                try
                {
                    // Загрузка всех игр из БД
                    GameComboBox.ItemsSource = _context.LW23Games.ToList();
                    _isGameListLoaded = true; 
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"Ошибка загрузки данных из БД: {ex.Message}", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
        }

        // Обработчик кнопки "Обзор..." (для выбора файла)
        private void BrowseButton_Click(object sender, RoutedEventArgs e)
        {
            OpenFileDialog openFileDialog = new OpenFileDialog
            {
                Filter = "Файлы изображений|*.jpg;*.jpeg;*.png;*.gif",
                Title = "Выберите файл логотипа для игры"
            };

            if (openFileDialog.ShowDialog() == true) 
            {
                LogoPathTextBox.Text = openFileDialog.FileName;
            }
        }

        // Обработчик кнопки "Сохранить" (Главная логика задания 3.1.3)
        private void SaveButton_Click(object sender, RoutedEventArgs e)
        {
            // 1. Проверка ввода
            if (GameComboBox.SelectedValue == null)
            {
                MessageBox.Show("Пожалуйста, выберите игру.", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                return;
            }
            string sourceFilePath = LogoPathTextBox.Text;
            if (string.IsNullOrWhiteSpace(sourceFilePath) || !File.Exists(sourceFilePath))
            {
                MessageBox.Show("Пожалуйста, выберите существующий файл логотипа.", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
                return;
            }

            int selectedGameId = (int)GameComboBox.SelectedValue;
            string fileName = Path.GetFileName(sourceFilePath);

            // 2. Эмуляция загрузки: определение и создание целевой папки
            string targetDirectory = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "GamesLogo");
            string targetFilePath = Path.Combine(targetDirectory, fileName);

            try
            {
                // Создание папки "GamesLogo", если она не существует
                if (!Directory.Exists(targetDirectory))
                {
                    Directory.CreateDirectory(targetDirectory);
                }

                // Копирование файла (эмуляция загрузки на сервер)
                File.Copy(sourceFilePath, targetFilePath, overwrite: true);

                // 3. Обновление записи в БД
                var gameToUpdate = _context.LW23Games.Find(selectedGameId);

                if (gameToUpdate != null)
                {
                    // Запись имени файла в поле logoFile
                    gameToUpdate.logoFile = fileName; 
                    _context.SaveChanges();
                    
                    MessageBox.Show($"Логотип '{fileName}' успешно загружен в папку и привязан к игре.", 
                                    "Успех", 
                                    MessageBoxButton.OK, 
                                    MessageBoxImage.Information);
                }
            }
            catch (Exception ex)
            {
                // Если возникла ошибка, например, проблемы с правами доступа к папке или БД
                MessageBox.Show($"Произошла ошибка при сохранении: {ex.Message}", "Ошибка", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}


