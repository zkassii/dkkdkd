CREATE VIEW V_AllSessionsWithCapacity
AS
SELECT
    S.SessionId AS 'Код сеанса',
    F.Title AS 'Название фильма',
    H.Cinema AS 'Кинотеатр',
    H.HallNumber AS 'Зал',
    S.Price AS 'Цена',
    S.StartDate AS 'Дата и время начала',
    -[span_2](start_span)- Вычисление общего количества мест, приведение к INT для предотвращения переполнения[span_2](end_span)
    CAST(H.RowsCount AS INT) * H.SeatsCount AS 'Общее количество мест'
FROM
    Session S
JOIN
    Film F ON S.FilmId = F.FilmId
JOIN
    Hall H ON S.HallId = H.HallId;
GO






CREATE VIEW V_FilmInfo
AS
SELECT
    F.FilmId AS 'Код фильма',
    F.Title AS 'Название',
    F.ReleaseYear AS 'Год выхода',
    -- Форматирование длительности в "ч Мм"
    CONCAT_WS(' ', 
        CAST(F.Duration / 60 AS NVARCHAR) + ' ч', 
        [span_3](start_span)CAST(F.Duration % 60 AS NVARCHAR) + ' Мм') AS 'Длительность',[span_3](end_span)
    -[span_4](start_span)- Объединение названий жанров в одну строку[span_4](end_span)
    STRING_AGG(G.Name, ', ') AS 'Жанр',
    F.Description AS 'Описание',
    F.StartRental AS 'Начало проката'
FROM
    Film F
JOIN
    FilmGenre FG ON F.FilmId = FG.FilmId
JOIN
    Genre G ON FG.GenreId = G.GenreId
GROUP BY
    F.FilmId, F.Title, F.ReleaseYear, F.Duration, F.Description, F.StartRental;
GO

