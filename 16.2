–Ø –º–æ–≥—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ññ16. –ü–æ—Å–∫–æ–ª—å–∫—É —è –Ω–µ –º–æ–≥—É –ø–∏—Å–∞—Ç—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥, —è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é –∫–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã, –º–µ—Ç–æ–¥—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ C#/ASP.NET Core, —Å–ª–µ–¥—É—è –ø—É–Ω–∫—Ç–∞–º 5.1-5.5.
1. üîë JWT-–°–µ—Ä–≤–∏—Å—ã –∏ –ú–æ–¥–µ–ª–∏ (–ø. 5.1, 5.5)
1.1. –ú–æ–¥–µ–ª–∏ –∏ DTO
// LoginRequest.cs (–ø. 5.1.1, 5.1.2)
public class LoginRequest
{
    public string Login { get; set; }
    public string Password { get; set; }
}

// TokenResponse.cs (–ø. 5.1.2)
public class TokenResponse
{
    public string Token { get; set; }
    public string? RefreshToken { get; set; }
}

// RefreshToken.cs (–ø. 5.5.1)
public class RefreshToken
{
    public int Id { get; set; }
    public int UserId { get; set; }
    public string Token { get; set; }
    public DateTime Expires { get; set; }
    public bool IsRevoked { get; set; } = false;
}

// CinemaUser.cs –∏ CinemaUserRole.cs (–Ω–∞ –æ—Å–Ω–æ–≤–µ –õ–† ‚Ññ15)
public class CinemaUser { /* ... */ }
public class CinemaUserRole { /* ... */ }

1.2. –°–µ—Ä–≤–∏—Å –¥–ª—è –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ JWT (–ø. 5.1.2)
// JwtService.cs (–†–µ–∞–ª–∏–∑–∞—Ü–∏—è GenerateToken, –¥–æ–±–∞–≤–∏–º GenerateRefreshToken)
public class JwtService
{
    private readonly IConfiguration _config;
    private readonly SymmetricSecurityKey _securityKey;

    public JwtService(IConfiguration config)
    {
        _config = config;
        _securityKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_config["Jwt:Key"]!));
    }

    public string GenerateToken(CinemaUser user, string roleName)
    {
        var claims = new[] // (–ø. 5.1.2 - claims: id, login, role)
        {
            new Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),
            new Claim(ClaimTypes.Name, user.Login),
            new Claim(ClaimTypes.Role, roleName) 
        };

        var token = new JwtSecurityToken(
            issuer: _config["Jwt:Issuer"], // (–ø. 5.1.2 - –∏–∑–¥–∞—Ç–µ–ª—å)
            audience: _config["Jwt:Audience"], // (–ø. 5.1.2 - –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å)
            claims: claims,
            expires: DateTime.Now.AddMinutes(15), // (–ø. 5.1.2 - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏)
            signingCredentials: new SigningCredentials(_securityKey, SecurityAlgorithms.HmacSha256) // (–ø. 5.1.2 - –∫–ª—é—á –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
        );

        return new JwtSecurityTokenHandler().WriteToken(token);
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Refresh-—Ç–æ–∫–µ–Ω–∞
    public string GenerateRefreshToken()
    {
        var randomNumber = new byte[32];
        using var rng = RandomNumberGenerator.Create();
        rng.GetBytes(randomNumber);
        return Convert.ToBase64String(randomNumber);
    }
}

2. üõ°Ô∏è –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (AuthController)
2.1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –õ–æ–≥–∏–Ω (–ø. 5.1.1, 5.1.2, 5.5.2)
[ApiController]
[Route("auth")]
public class AuthController : ControllerBase
{
    private readonly IUserService _userService; // –î–ª—è —Ä–∞–±–æ—Ç—ã —Å CinemaUser/Roles
    private readonly IJwtService _jwtService;

    // ... (–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä)

    // POST /auth/register (–ø. 5.1.1)
    [HttpPost("register")]
    public async Task<IActionResult> Register([FromBody] LoginRequest request)
    {
        // 1. –•–µ—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å (–ø. 5.1.1)
        var passwordHash = HashService.HashPassword(request.Password); 
        
        // 2. –†–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å. (–ø. 5.1.1)
        // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ RoleId = 1 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–æ–ª–∏ "–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å" –≤ –ë–î.
        var user = await _userService.Register(request.Login, passwordHash, 1 /*Visitor RoleId*/); 

        return Ok("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω.");
    }

    // POST /auth/login (–ø. 5.1.2, –ø. 5.5.2)
    [HttpPost("login")]
    public async Task<ActionResult<TokenResponse>> Login([FromBody] LoginRequest request)
    {
        var (user, roleName) = await _userService.Authenticate(request.Login, request.Password);

        if (user == null)
            return Unauthorized("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å.");

        // 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT
        var token = _jwtService.GenerateToken(user, roleName); 

        // 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Refresh-—Ç–æ–∫–µ–Ω–∞ (–ø. 5.5.2)
        var refreshTokenString = _jwtService.GenerateRefreshToken();
        await _userService.SaveRefreshToken(user.Id, refreshTokenString, DateTime.Now.AddDays(7));

        // 3. –í–æ–∑–≤—Ä–∞—Ç TokenResponse (–ø. 5.1.2, –ø. 5.5.2)
        return Ok(new TokenResponse { Token = token, RefreshToken = refreshTokenString });
    }

    // POST /auth/refresh (–ø. 5.5.3)
    [HttpPost("refresh")]
    public async Task<ActionResult<TokenResponse>> Refresh([FromBody] string expiredRefreshToken)
    {
        var storedToken = await _userService.GetRefreshToken(expiredRefreshToken);

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ (—Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏, –æ—Ç–æ–∑–≤–∞–Ω –ª–∏)
        if (storedToken == null || storedToken.IsRevoked || storedToken.Expires < DateTime.Now)
        {
            return Unauthorized("–ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π refresh-—Ç–æ–∫–µ–Ω.");
        }

        // 2. –û—Ç–∑—ã–≤ —Å—Ç–∞—Ä–æ–≥–æ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
        await _userService.RevokeRefreshToken(storedToken.Id); // –û—Ç–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω (–ø. 5.5.3)
        var user = await _userService.GetUserById(storedToken.UserId);
        
        var newJwtToken = _jwtService.GenerateToken(user!, user!.Role.Name);
        
        // 3. –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ Refresh-—Ç–æ–∫–µ–Ω–∞ (–ø. 5.5.3)
        var newRefreshTokenString = _jwtService.GenerateRefreshToken();
        await _userService.SaveRefreshToken(user.Id, newRefreshTokenString, DateTime.Now.AddDays(7));

        return Ok(new TokenResponse { Token = newJwtToken, RefreshToken = newRefreshTokenString });
    }
}

3. ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Program.cs (–ø. 5.2.1)
// Program.cs (–¥–ª—è .NET 6+)

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
builder.Services.AddScoped<IJwtService, JwtService>();
// ... –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ UserService, DbContext, etc.

// 5.2.1 - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =>
    {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true, // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–¥–∞—Ç–µ–ª—è (–ø. 5.2.1)
            ValidateAudience = true, // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è (–ø. 5.2.1)
            ValidateLifetime = true, // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ (–ø. 5.2.1)
            ValidateIssuerSigningKey = true, // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª—é—á–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ø. 5.2.1)
            
            ValidIssuer = builder.Configuration["Jwt:Issuer"],
            ValidAudience = builder.Configuration["Jwt:Audience"],
            IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(builder.Configuration["Jwt:Key"]!))
        };
    });

builder.Services.AddAuthorization(); // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Middleware
app.UseAuthentication(); 
app.UseAuthorization();

4. üö™ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –î–æ—Å—Ç—É–ø–∞ (–ø. 5.2, 5.3)
4.1. –î–æ—Å—Ç—É–ø –ø–æ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø. 5.2.2)
[ApiController]
public class FilmsProfileController : ControllerBase
{
    // GET /films - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø. 5.2.2)
    [HttpGet("films")]
    [AllowAnonymous] 
    public IActionResult GetFilms()
    {
        return Ok(new { Message = "–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏." });
    }

    // GET /profile - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–ø. 5.2.2)
    [Authorize]
    [HttpGet("profile")]
    public IActionResult GetProfile()
    {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Ç–µ–∫—É—â–µ–º (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
        var login = User.FindFirstValue(ClaimTypes.Name);
        var role = User.FindFirstValue(ClaimTypes.Role);
        
        return Ok(new { UserId = userId, Login = login, Role = role, Message = "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º." });
    }
}

4.2. –î–æ—Å—Ç—É–ø –ø–æ –†–æ–ª–∏ (–ø. 5.3.1)
[ApiController]
public class RestrictedController : ControllerBase
{
    // GET /tickets/{id} - –¥–ª—è –±–∏–ª–µ—Ç–µ—Ä–∞ –∏ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è (–ø. 5.3.1)
    [Authorize(Roles = "–±–∏–ª–µ—Ç–µ—Ä, –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å")]
    [HttpGet("tickets/{id}")]
    public IActionResult CheckTicket(int id)
    {
        var role = User.FindFirstValue(ClaimTypes.Role);
        return Ok($"–ë–∏–ª–µ—Ç ‚Ññ{id} –ø—Ä–æ–≤–µ—Ä–µ–Ω. –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è —Ä–æ–ª–µ–π: –±–∏–ª–µ—Ç–µ—Ä/–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å. –í–∞—à–∞ —Ä–æ–ª—å: {role}");
    }

    // POST /users - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞) (–ø. 5.3.1)
    [Authorize(Roles = "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä")]
    [HttpPost("users")]
    public IActionResult AddUser([FromBody] LoginRequest newUser)
    {
        return Ok($"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {newUser.Login} –¥–æ–±–∞–≤–ª–µ–Ω. –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.");
    }
}

(–ø. 5.2.3 –∏ 5.3.2 - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –≠—Ç–∏ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ Postman —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Bearer —Ç–æ–∫–µ–Ω–∞.)
5. üíª –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø. 5.4, 5.5.4)
5.1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∏ —Å –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–ø. 5.4.1, 5.4.2)
public class ApiClient
{
    private readonly HttpClient _httpClient = new() { BaseAddress = new Uri("http://localhost:5000/") };

    // 5.4.1 - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    public async Task TestPublicApi()
    {
        Console.WriteLine("--- –¢–µ—Å—Ç /films (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) ---");
        var response = await _httpClient.GetAsync("films");
        Console.WriteLine($"Status: {response.StatusCode}, Content: {await response.Content.ReadAsStringAsync()}");
    }

    // 5.4.2 - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
    public async Task TestAuthorizedApi(string token)
    {
        Console.WriteLine("\n--- –¢–µ—Å—Ç /profile (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é) ---");
        _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
        var response = await _httpClient.GetAsync("profile");
        Console.WriteLine($"Status: {response.StatusCode}, Content: {await response.Content.ReadAsStringAsync()}");
    }
}

5.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ 401 –∏ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¢–æ–∫–µ–Ω–∞ (–ø. 5.5.4)
public async Task<string> CallApiWithRefresh(string url, ref string accessToken, ref string refreshToken)
{
    _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);
    var response = await _httpClient.GetAsync(url);

    // 5.5.4 - –û–±—Ä–∞–±–æ—Ç–∫–∞ 401
    if (response.StatusCode == HttpStatusCode.Unauthorized) 
    {
        Console.WriteLine("–ü–æ–ª—É—á–µ–Ω 401. –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ –∏—Å—Ç–µ–∫, –ø—ã—Ç–∞—é—Å—å –æ–±–Ω–æ–≤–∏—Ç—å...");

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –ø–æ refresh-—Ç–æ–∫–µ–Ω—É
        var refreshResponse = await GetNewToken(refreshToken);
        
        if (refreshResponse != null)
        {
            accessToken = refreshResponse.Token;
            refreshToken = refreshResponse.RefreshToken!;
            Console.WriteLine("–¢–æ–∫–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã. –ü–æ–≤—Ç–æ—Ä—è—é –∑–∞–ø—Ä–æ—Å.");

            // –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
            _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);
            response = await _httpClient.GetAsync(url);
        }
        else
        {
            return "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω.";
        }
    }
    
    return await response.Content.ReadAsStringAsync();
}

private async Task<TokenResponse?> GetNewToken(string oldRefreshToken)
{
    var content = new StringContent($"\"{oldRefreshToken}\"", Encoding.UTF8, "application/json");
    var response = await _httpClient.PostAsync("auth/refresh", content);
    
    if (response.IsSuccessStatusCode)
    {
        var jsonString = await response.Content.ReadAsStringAsync();
        return JsonSerializer.Deserialize<TokenResponse>(jsonString);
    }
    return null;
}

6. üìù –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –í–æ–ø—Ä–æ—Å—ã
8.1. –ß—Ç–æ —Ç–∞–∫–æ–µ JWT –∏ –¥–ª—è —á–µ–≥–æ –æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω?
[cite_start]JWT (JSON Web Token) ‚Äî —ç—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–ª—è URL —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –≤ –≤–∏–¥–µ –æ–±—ä–µ–∫—Ç–∞ JSON. [cite_start]–û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏. [cite_start]–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ç–æ–∫–µ–Ω, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–æ–º –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–∞–º –∏ —Ä–µ—Å—É—Ä—Å–∞–º.
8.2. –ò–∑ –∫–∞–∫–∏—Ö —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —á–∞—Å—Ç–µ–π —Å–æ—Å—Ç–æ–∏—Ç JWT –∏ –∫–∞–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏?
[cite_start]JWT —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö —á–∞—Å—Ç–µ–π, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞–º–∏:
 * [cite_start]Header (–ó–∞–≥–æ–ª–æ–≤–æ–∫): –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞ (–æ–±—ã—á–Ω–æ JWT) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, HMAC SHA256 –∏–ª–∏ RSA).
 * Payload (–ù–∞–≥—Ä—É–∑–∫–∞/–°–æ–¥–µ—Ä–∂–∏–º–æ–µ): –°–æ–¥–µ—Ä–∂–∏—Ç claims (–∑–∞—è–≤–ª–µ–Ω–∏—è) ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. [cite_start]–ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è id, login, –∏ role –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
 * [cite_start]Signature (–ü–æ–¥–ø–∏—Å—å): –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ó–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –ù–∞–≥—Ä—É–∑–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞. [cite_start]–ü–æ–¥–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–≥–æ, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–¥–∞—á–∏.
8.3. –í —á–µ–º —Ä–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ –∏ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT?
 * [cite_start]–°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, HMAC): –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∫–∞–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ (—Å–µ—Ä–≤–µ—Ä–æ–º), —Ç–∞–∫ –∏ –¥–ª—è –µ–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (API-—Å–µ—Ä–≤–µ—Ä–æ–º). –≠—Ç–æ –ø—Ä–æ—â–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
 * [cite_start]–ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, RSA): –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä—É –∫–ª—é—á–µ–π ‚Äî –∑–∞–∫—Ä—ã—Ç—ã–π –∫–ª—é—á –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ –∏ –æ—Ç–∫—Ä—ã—Ç—ã–π –∫–ª—é—á –¥–ª—è –µ–µ –ø—Ä–æ–≤–µ—Ä–∫–∏. [cite_start]–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤—É —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É –∫–ª—é—á—É, –∫–æ—Ç–æ—Ä—ã–º –æ–Ω –±—ã–ª –ø–æ–¥–ø–∏—Å–∞–Ω.
8.4. –ß—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ claims –≤ JWT?
[cite_start]–í —Ä–∞–∑–¥–µ–ª–µ claims —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∑–∞—è–≤–ª–µ–Ω–∏—è –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ç–æ–∫–µ–Ω–µ. –û–Ω–∏ –º–æ–≥—É—Ç –≤–∫–ª—é—á–∞—Ç—å:
 * [cite_start]–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ claims (Registered claims): –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è, —Ç–∞–∫–∏–µ –∫–∞–∫ –∏–∑–¥–∞—Ç–µ–ª—å (iss), –ø–æ–ª—É—á–∞—Ç–µ–ª—å (aud), –∏ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (exp).
 * –ü—É–±–ª–∏—á–Ω—ã–µ claims (Public claims): –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º.
 * [cite_start]–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ claims (Private claims): –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–ª—è, —Ç–∞–∫–∏–µ –∫–∞–∫ id, login, –∏ role –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
8.5. –î–ª—è —á–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è refresh-—Ç–æ–∫–µ–Ω?
[cite_start]Refresh-—Ç–æ–∫–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ access-—Ç–æ–∫–µ–Ω–∞ (JWT) –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–µ–∫—É—â–µ–≥–æ access-—Ç–æ–∫–µ–Ω–∞ –∏—Å—Ç–µ–∫ (401 –æ—à–∏–±–∫–∞).
–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å:
 * –£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: Access-—Ç–æ–∫–µ–Ω—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15 –º–∏–Ω—É—Ç), —á—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –ø–µ—Ä–∏–æ–¥, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω.
 * –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞: Refresh-—Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7 –¥–Ω–µ–π) –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ access-—Ç–æ–∫–µ–Ω—ã –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è.
